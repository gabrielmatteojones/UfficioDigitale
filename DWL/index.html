<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ufficio Digitale - Login Google</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";

    // Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCm95m6BvicUXYOd6jdEXSxQnANnnwbv40",
      authDomain: "ufficiodigitalegmj.firebaseapp.com",
      projectId: "ufficiodigitalegmj",
      storageBucket: "ufficiodigitalegmj.firebasestorage.app",
      messagingSenderId: "385070744833",
      appId: "1:385070744833:web:a8d0217554dd6484254700",
      measurementId: "G-9WD62WGFBJ"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const loginBtn = document.getElementById("login");
    const logoutBtn = document.getElementById("logout");
    const userInfo = document.getElementById("user-info");
    const container = document.getElementById("container");

    // Login Google con redirect
    loginBtn.addEventListener("click", () => {
      signInWithPopup(auth, provider)
        .then(result => {
          const user = result.user;
          console.log("Login effettuato:", user);
          // Redirect immediato dopo login
          window.location.href = "/ufficio/index.php.html";
        })
        .catch(error => {
          console.error("Errore login:", error);
          alert("Errore durante il login: " + error.message);
        });
    });

    // Logout
    logoutBtn.addEventListener("click", () => {
      signOut(auth);
    });

    // Gestione stato utente
    onAuthStateChanged(auth, (user) => {
      if (user) {
        userInfo.innerHTML = `
          <img src="${user.photoURL}" alt="Foto utente" class="rounded-full w-28 h-28 shadow-lg mb-4" />
          <h2 class="text-2xl font-semibold text-gray-800">${user.displayName}</h2>
          <p class="text-gray-600 mb-6">${user.email}</p>
          <button id="logout" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-8 rounded-full transition duration-200">
            Esci
          </button>
        `;
        loginBtn.style.display = "none";
        // Ri-assegno l'evento al nuovo pulsante logout
        document.getElementById("logout").addEventListener("click", () => {
          signOut(auth);
        });
      } else {
        userInfo.innerHTML = `
          <h1 class="text-3xl font-bold mb-6 text-blue-600">Benvenuto in Ufficio Digitale</h1>
          <p class="text-gray-700 mb-8">Accedi con Google per gestire il tuo account e accedere ai servizi.</p>
        `;
        loginBtn.style.display = "inline-block";
      }
    });
  </script>
</head>
<body class="bg-gradient-to-tr from-blue-400 to-indigo-700 min-h-screen flex items-center justify-center p-6">
  <div id="container" class="bg-white rounded-3xl shadow-2xl p-10 max-w-md w-full text-center">
    <div id="user-info" class="mb-8">
      <p class="text-gray-600">Caricamento stato utente...</p>
    </div>
    <button
      id="login"
      class="bg-white border-2 border-gray-300 hover:border-blue-600 hover:bg-blue-50 text-gray-700 font-semibold py-3 px-8 rounded-full flex items-center justify-center mx-auto gap-3 transition duration-200"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 48 48" fill="none">
        <path fill="#FFC107" d="M43.6 20.4H42V20H24v8h11.3C34.7 32 30 35 24 35c-7 0-13-6-13-13s6-13 13-13c3.1 0 5.9 1.2 8 3.1l5.7-5.7C33.2 7.4 28.8 6 24 6 12.95 6 4 14.95 4 26s8.95 20 20 20c11 0 20-8.95 20-20 0-1.3-.2-2.6-.4-3.6z"/>
        <path fill="#FF3D00" d="M6.3 14.7l6.6 4.9C14 17 18.6 14 24 14c3.1 0 5.9 1.2 8 3.1l5.7-5.7C33.2 7.4 28.8 6 24 6c-7.8 0-14.3 4.7-17.7 11.7z"/>
        <path fill="#4CAF50" d="M24 42c6 0 11-4.2 12.2-10.1H24v-7.7h19.1c-.9 5.4-5.4 10-11.9 10z"/>
        <path fill="#1976D2" d="M43.6 20.4H42V20H24v8h11.3c-1 2.8-3 5.2-6.1 6.6v5h9.3c5.1-4.7 8.1-11.7 8.1-20 0-1.3-.2-2.6-.4-3.6z"/>
      </svg>
      Accedi con Google
    </button>
  </div>
</body>
</html>
